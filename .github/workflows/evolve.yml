name: evolve
on:
  schedule:
    - cron: '7,37 * * * *'
permissions:
  contents: write
concurrency:
  group: evolve
  cancel-in-progress: true
jobs:
  evolve:
    runs-on: ubuntu-latest
    timeout-minutes: 1
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: '3.11' }
      - name: Install deps
        run: python -m pip install -r requirements.txt || true
      - name: Ensure seeds.json exists
        run: |
          test -f seeds.json || echo '["find stale oracles","mispriced LPs","curve inversion","high LVR pools"]' > seeds.json
      - name: Evolve seeds (read-only heuristic)
        run: |
          python - << 'PY'
          import json,random,hashlib,time,os
          seeds = json.load(open('seeds.json'))
          words = set(sum([s.split() for s in seeds], []))
          words |= {"oracle","lag","slippage","inversion","TWAP","decay","LVR","misaligned"}
          new = random.sample(sorted(words), k=min(6, len(words)))
          json.dump(new, open('seeds.json','w'))
          open('.last_evolve_utc','w').write(time.strftime('%Y-%m-%dT%H:%M:%SZ', time.gmtime()))
          PY
      - name: Commit evolution
        run: |
          git config user.name "cortex-bot"
          git config user.email "cortex-bot@users.noreply.github.com"
          git add seeds.json .last_evolve_utc
          git commit -m "evolve: $(date -u +%FT%TZ)" || echo "no changes"
          git push
